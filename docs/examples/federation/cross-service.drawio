<mxfile host="app.diagrams.net" modified="2024-01-15T11:00:00.000Z" agent="5.0" etag="ghi789" version="22.1.16" type="device">
  <diagram name="Service-to-Service Federation" id="service-to-service-federation">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- Title -->
        <mxCell id="title" value="Service-to-Service Federation: One Service Scrapes Another" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="300" y="20" width="550" height="30" as="geometry" />
        </mxCell>
        
        <!-- Service A Prometheus (Source) -->
        <mxCell id="service-a-prometheus" value="Service A Prometheus&#xa;(Database Team)&#xa;:9090&#xa;&#xa;📊 Database Metrics:&#xa;• mysql_connections&#xa;• query_duration&#xa;• db_cpu_usage&#xa;• db_memory_usage&#xa;• connection_pool_size" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1D5E7;strokeColor=#9673A6;fontSize=12;fontStyle=1;align=center;" vertex="1" parent="1">
          <mxGeometry x="100" y="100" width="200" height="140" as="geometry" />
        </mxCell>
        
        <!-- Service B Prometheus (Destination) -->
        <mxCell id="service-b-prometheus" value="Service B Prometheus&#xa;(Payment Team)&#xa;:9091&#xa;&#xa;📊 Payment Metrics:&#xa;• payment_transactions&#xa;• payment_errors&#xa;• api_response_time&#xa;&#xa;📊 Federated DB Metrics:&#xa;• mysql_connections&#xa;• query_duration" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DAE8FC;strokeColor=#6C8EBF;fontSize=12;fontStyle=1;align=center;" vertex="1" parent="1">
          <mxGeometry x="500" y="100" width="200" height="160" as="geometry" />
        </mxCell>
        
        <!-- Federation Arrow -->
        <mxCell id="federation-arrow" value="GET /federate&#xa;&#xa;Scrapes SELECTED data:&#xa;match[]:&#xa;• mysql_connections&#xa;• query_duration&#xa;• {job=&quot;payment-db&quot;}&#xa;&#xa;honor_labels: true" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#D79B00;strokeWidth=4;fontSize=11;fontColor=#D79B00;fontStyle=1;" edge="1" parent="1" source="service-a-prometheus" target="service-b-prometheus">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="400" y="180" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Service A Targets -->
        <mxCell id="service-a-targets" value="Database Infrastructure&#xa;&#xa;🗄️ MySQL Cluster:&#xa;• mysql-master:3306&#xa;• mysql-slave-1:3306&#xa;• mysql-slave-2:3306&#xa;&#xa;🗄️ Redis Cache:&#xa;• redis-1:6379&#xa;• redis-2:6379&#xa;&#xa;📊 DB Exporters:&#xa;• mysqld_exporter:9104&#xa;• redis_exporter:9121" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F8CECC;strokeColor=#B85450;fontSize=11;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="50" y="320" width="300" height="180" as="geometry" />
        </mxCell>
        
        <!-- Service B Targets -->
        <mxCell id="service-b-targets" value="Payment Service Infrastructure&#xa;&#xa;💳 Payment APIs:&#xa;• payment-api-1:8080&#xa;• payment-api-2:8080&#xa;• payment-api-3:8080&#xa;&#xa;🔄 Payment Workers:&#xa;• payment-worker-1:8081&#xa;• payment-worker-2:8081&#xa;&#xa;📊 Custom Metrics:&#xa;• transaction_processor&#xa;• fraud_detector" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D5E8D4;strokeColor=#82B366;fontSize=11;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="450" y="320" width="300" height="180" as="geometry" />
        </mxCell>
        
        <!-- Scrape Arrows -->
        <mxCell id="service-a-scrape" value="scrape&#xa;database metrics" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#9673A6;strokeWidth=2;fontSize=10;" edge="1" parent="1" source="service-a-prometheus" target="service-a-targets">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <mxCell id="service-b-scrape" value="scrape&#xa;payment metrics" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#6C8EBF;strokeWidth=2;fontSize=10;" edge="1" parent="1" source="service-b-prometheus" target="service-b-targets">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        
        <!-- Benefits Box -->
        <mxCell id="benefits" value="🎯 Why Service B Federates from Service A:&#xa;&#xa;✅ Payment team needs database context:&#xa;   • Slow payments → Check DB query time&#xa;   • Payment errors → Check DB connections&#xa;   • Performance issues → Check DB load&#xa;&#xa;✅ Unified alerting in Payment Prometheus:&#xa;   • Alert: High payment errors + DB issues&#xa;   • Alert: Slow API + High DB query time&#xa;&#xa;✅ Single dashboard for Payment team:&#xa;   • Payment metrics + DB performance&#xa;   • No need to access Database team's Prometheus" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF2CC;strokeColor=#D6B656;fontSize=11;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="800" y="100" width="320" height="200" as="geometry" />
        </mxCell>
        
        <!-- Configuration Example -->
        <mxCell id="config-example" value="Service B Prometheus Configuration:&#xa;&#xa;scrape_configs:&#xa;  # Own payment service metrics&#xa;  - job_name: 'payment-service'&#xa;    static_configs:&#xa;      - targets: ['payment-api:8080']&#xa;&#xa;  # Federate selected DB metrics from Service A&#xa;  - job_name: 'federate-database'&#xa;    scrape_interval: 30s&#xa;    honor_labels: true&#xa;    metrics_path: '/federate'&#xa;    params:&#xa;      'match[]':&#xa;        - 'mysql_connections'&#xa;        - 'mysql_slow_queries'&#xa;        - '{job=&quot;payment-db&quot;}'&#xa;    static_configs:&#xa;      - targets: ['database-prometheus:9090']" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F5F5F5;strokeColor=#666666;fontSize=9;align=left;verticalAlign=top;fontFamily=Courier New;" vertex="1" parent="1">
          <mxGeometry x="50" y="530" width="450" height="220" as="geometry" />
        </mxCell>
        
        <!-- Query Examples -->
        <mxCell id="query-examples" value="Unified Queries in Service B Prometheus:&#xa;&#xa;# Correlate payment errors with DB issues&#xa;rate(payment_errors_total[5m]) and&#xa;mysql_connections > 80&#xa;&#xa;# Payment performance vs DB performance&#xa;histogram_quantile(0.95,&#xa;  rate(payment_duration_bucket[5m])&#xa;) / mysql_query_duration_avg&#xa;&#xa;# Alert: Payment issues + DB problems&#xa;(rate(payment_errors_total[5m]) > 0.1) and&#xa;(mysql_slow_queries > 10)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1D5E7;strokeColor=#9673A6;fontSize=10;align=left;verticalAlign=top;fontFamily=Courier New;" vertex="1" parent="1">
          <mxGeometry x="550" y="530" width="400" height="160" as="geometry" />
        </mxCell>
        
        <!-- Data Flow Steps -->
        <mxCell id="step-1" value="1️⃣ Service A Prometheus&#xa;   collects DB metrics" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontColor=#9673A6;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="100" y="270" width="200" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="step-2" value="2️⃣ Service B Prometheus&#xa;   federates selected DB metrics" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontColor=#D79B00;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="320" y="60" width="160" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="step-3" value="3️⃣ Service B Prometheus&#xa;   collects own payment metrics" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontColor=#6C8EBF;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="500" y="270" width="200" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="step-4" value="4️⃣ Payment team queries&#xa;   both datasets together" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontColor=#D6B656;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="800" y="320" width="200" height="40" as="geometry" />
        </mxCell>
        
        <!-- Key Concept Box -->
        <mxCell id="key-concept" value="🔑 Key Concept:&#xa;&#xa;Service B doesn't want ALL database metrics,&#xa;only the ones relevant to payment processing.&#xa;&#xa;Federation allows selective data sharing&#xa;between independent Prometheus servers." style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFE6CC;strokeColor=#D79B00;fontSize=12;align=left;verticalAlign=top;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="800" y="380" width="320" height="100" as="geometry" />
        </mxCell>
        
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>